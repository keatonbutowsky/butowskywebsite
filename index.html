<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Butowsky Family</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Hero Section with Family Photo */
        .hero {
            min-height: 100vh;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 2rem;
        }

        .hero-title {
            font-size: clamp(2.5rem, 8vw, 6rem);
            font-weight: 300;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
            text-align: center;
            opacity: 0;
            animation: fadeInUp 1.2s ease forwards;
            z-index: 2;
        }

        .hero-subtitle {
            font-size: clamp(1rem, 2vw, 1.5rem);
            font-weight: 200;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-bottom: 2rem;
            opacity: 0;
            animation: fadeInUp 1.2s ease 0.3s forwards;
            z-index: 2;
        }

        .family-photo-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            opacity: 0;
            animation: fadeInUp 1.2s ease 0.6s forwards;
            z-index: 2;
            transition: opacity 0.8s ease;
        }

        .family-photo {
            width: 100%;
            height: auto;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        /* Scroll Indicator */
        .scroll-indicator {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            animation: fadeInUp 1.2s ease 1.5s forwards, bounce 2s ease 2.5s infinite;
            z-index: 2;
        }

        @media (max-height: 800px) {
            .scroll-indicator {
                bottom: 1rem;
            }
        }

        .scroll-text {
            font-size: 0.9rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            font-weight: 300;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .scroll-line {
            width: 1px;
            height: 40px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.8), transparent);
            margin: 0 auto;
        }

        /* Family Tree Container - FIXED: Increased height for all scroll stages */
        .tree-container {
            min-height: 350vh;
            position: relative;
            padding: 50vh 2rem 20vh;
        }

        .tree-canvas {
            position: sticky;
            top: 0;
            height: 100vh;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tree-svg {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 1;
            pointer-events: none;
        }

        /* Family Member Circles */
        .member {
            position: absolute;
            opacity: 0;
            transform: translateX(-50%) scale(0.8);
            transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), 
                        transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            z-index: 10;
            pointer-events: none;
        }

        .member.visible {
            opacity: 1;
            transform: translateX(-50%) scale(1);
            pointer-events: auto;
        }

        .member-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 4px solid rgba(255, 255, 255, 0.3);
            transition: all 0.4s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        .member:hover .member-circle {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 15px 60px rgba(42, 82, 152, 0.6);
        }

        .member-name {
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            line-height: 1.2;
        }

        .member-year {
            font-size: 0.85rem;
            font-weight: 300;
            opacity: 0.8;
            margin-top: 0.3rem;
        }

        /* Connection Lines - FIXED: Smooth drawing animation */
        .connection-line {
            stroke: rgba(255, 255, 255, 0.4);
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .connection-line.visible {
            opacity: 1;
        }

        .connection-line.animate {
            animation: drawLine 1s ease forwards;
        }

        @keyframes drawLine {
            from {
                stroke-dashoffset: var(--line-length);
            }
            to {
                stroke-dashoffset: 0;
            }
        }

        /* Marriage/Relationship Labels */
        .relationship-label {
            position: absolute;
            font-size: 0.9rem;
            font-weight: 300;
            opacity: 0;
            transform: translateX(-50%) translateY(10px);
            transition: opacity 0.6s ease, transform 0.6s ease;
            background: rgba(0, 0, 0, 0.6);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 5;
            white-space: nowrap;
        }

        .relationship-label.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Bio Modal */
        .bio-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .bio-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .bio-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 20px;
            padding: 3rem;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideUp 0.4s ease;
            -webkit-overflow-scrolling: touch;
        }

        .bio-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .bio-close:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }

        .bio-header {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .bio-text {
            line-height: 1.8;
            font-size: 1.1rem;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 2rem;
        }

        .bio-links {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .bio-link {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: white;
            text-decoration: none;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .bio-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            40% {
                transform: translateX(-50%) translateY(-10px);
            }
            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        /* Responsive - Tablet */
        @media (max-width: 768px) {
            .hero {
                padding: 1rem;
                justify-content: flex-start;
                padding-top: 3rem;
            }

            .hero-title {
                font-size: 2rem;
                margin-bottom: 0.5rem;
            }

            .hero-subtitle {
                font-size: 0.8rem;
                margin-bottom: 1.5rem;
            }

            .family-photo-container {
                max-width: 90%;
            }

            .tree-container {
                min-height: 320vh;
            }

            .member-circle {
                width: 100px;
                height: 100px;
            }

            .member-name {
                font-size: 0.85rem;
                line-height: 1.1;
            }

            .member-year {
                font-size: 0.7rem;
            }

            .bio-content {
                padding: 2rem;
            }

            .bio-header {
                font-size: 1.8rem;
            }

            .bio-text {
                font-size: 1rem;
            }

            /* Reposition family members for tablet/mobile */
            #ed { left: 30% !important; top: 18% !important; }
            #dani { left: 70% !important; top: 18% !important; }
            #marriageLabel { left: 50% !important; top: 14% !important; font-size: 0.75rem; }
            
            #lauren { left: 30% !important; top: 45% !important; }
            #keaton { left: 70% !important; top: 45% !important; }
            
            #ben { left: 18% !important; top: 72% !important; }
            #benLaurenLabel { left: 24% !important; top: 66% !important; font-size: 0.75rem; }
            
            #megan { left: 82% !important; top: 72% !important; }
            #meganKeatonLabel { left: 76% !important; top: 66% !important; font-size: 0.75rem; }

            .scroll-indicator {
                bottom: 0.5rem;
            }

            .scroll-text {
                font-size: 0.7rem;
            }

            .relationship-label {
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
            }
        }

        /* Responsive - Mobile */
        @media (max-width: 480px) {
            .hero {
                padding-top: 2rem;
            }

            .hero-title {
                font-size: 1.8rem;
            }

            .hero-subtitle {
                font-size: 0.7rem;
                letter-spacing: 0.2em;
            }

            .tree-container {
                min-height: 300vh;
                padding: 40vh 1rem 15vh;
            }

            .member-circle {
                width: 70px;
                height: 70px;
            }

            .member-name {
                font-size: 0.65rem;
            }

            .member-year {
                font-size: 0.55rem;
            }

            /* Tighter mobile positioning */
            #ed { left: 30% !important; top: 15% !important; }
            #dani { left: 70% !important; top: 15% !important; }
            #marriageLabel { left: 50% !important; top: 11% !important; font-size: 0.65rem; }
            
            #lauren { left: 30% !important; top: 42% !important; }
            #keaton { left: 70% !important; top: 42% !important; }
            
            #ben { left: 20% !important; top: 70% !important; }
            #benLaurenLabel { left: 25% !important; top: 63% !important; font-size: 0.65rem; }
            
            #megan { left: 80% !important; top: 70% !important; }
            #meganKeatonLabel { left: 75% !important; top: 63% !important; font-size: 0.65rem; }

            .bio-content {
                padding: 1.5rem;
                border-radius: 15px;
            }

            .bio-header {
                font-size: 1.5rem;
                padding-right: 2rem;
            }

            .bio-text {
                font-size: 0.9rem;
                line-height: 1.6;
            }

            .bio-close {
                top: 1rem;
                right: 1rem;
                width: 32px;
                height: 32px;
                font-size: 1.5rem;
            }

            .bio-link {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }
        }

        /* Extra small phones */
        @media (max-width: 360px) {
            .member-circle {
                width: 60px;
                height: 60px;
            }

            .member-name {
                font-size: 0.55rem;
            }

            .member-year {
                font-size: 0.5rem;
            }

            #ben { left: 22% !important; }
            #megan { left: 78% !important; }
        }

        /* iOS Safari fixes */
        @supports (-webkit-touch-callout: none) {
            .tree-canvas {
                height: -webkit-fill-available;
            }
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <section class="hero">
        <h1 class="hero-title">THE BUTOWSKY FAMILY</h1>
        <p class="hero-subtitle">A Legacy of Excellence</p>
        
        <div class="family-photo-container" id="familyPhoto">
            <img src="family-photo.jpg" alt="The Butowsky Family" class="family-photo">
        </div>

        <div class="scroll-indicator">
            <div class="scroll-text">Scroll to explore</div>
            <div class="scroll-line"></div>
        </div>
    </section>

    <!-- Family Tree Section -->
    <div class="tree-container" id="treeContainer">
        <div class="tree-canvas" id="treeCanvas">
            <svg class="tree-svg" id="treeSvg"></svg>
            
            <!-- Ed Butowsky -->
            <div class="member" id="ed" data-member="ed" style="left: 35%; top: 25%;">
                <div class="member-circle">
                    <div class="member-name">Ed<br>Butowsky</div>
                    <div class="member-year">(b. 1962)</div>
                </div>
            </div>

            <!-- Dani Butowsky -->
            <div class="member" id="dani" data-member="dani" style="left: 65%; top: 25%;">
                <div class="member-circle">
                    <div class="member-name">Dani<br>Butowsky</div>
                    <div class="member-year">(b. 1964)</div>
                </div>
            </div>

            <!-- Marriage Label -->
            <div class="relationship-label" id="marriageLabel" style="left: 50%; top: 22%;">
                Married 1991
            </div>

            <!-- Lauren Sheppard -->
            <div class="member" id="lauren" data-member="lauren" style="left: 35%; top: 55%;">
                <div class="member-circle">
                    <div class="member-name">Lauren<br>Sheppard</div>
                    <div class="member-year">(b. 1995)</div>
                </div>
            </div>

            <!-- Keaton Butowsky -->
            <div class="member" id="keaton" data-member="keaton" style="left: 65%; top: 55%;">
                <div class="member-circle">
                    <div class="member-name">Keaton<br>Butowsky</div>
                    <div class="member-year">(b. 1998)</div>
                </div>
            </div>

            <!-- Ben Sheppard -->
            <div class="member" id="ben" data-member="ben" style="left: 18%; top: 75%;">
                <div class="member-circle">
                    <div class="member-name">Ben<br>Sheppard</div>
                    <div class="member-year">(b. 1994)</div>
                </div>
            </div>

            <!-- Ben-Lauren Marriage Label -->
            <div class="relationship-label" id="benLaurenLabel" style="left: 26%; top: 70%;">
                Married 2024
            </div>

            <!-- Megan Williams -->
            <div class="member" id="megan" data-member="megan" style="left: 82%; top: 75%;">
                <div class="member-circle">
                    <div class="member-name">Megan<br>Williams</div>
                    <div class="member-year">(b. 2000)</div>
                </div>
            </div>

            <!-- Megan-Keaton Marriage Label -->
            <div class="relationship-label" id="meganKeatonLabel" style="left: 74%; top: 70%;">
                Will Marry 2026
            </div>
        </div>
    </div>

    <!-- Bio Modal -->
    <div class="bio-modal" id="bioModal">
        <div class="bio-content">
            <button class="bio-close" onclick="closeBio()">×</button>
            <h2 class="bio-header" id="bioName"></h2>
            <div id="bioText"></div>
            <div class="bio-links" id="bioLinks"></div>
        </div>
    </div>

    <script>
        // Bio data
        const bios = {
            ed: {
                name: "Ed Butowsky",
                paragraphs: [
                    "Ed Butowsky is an accomplished investment professional with extensive experience across financial markets, regulation, and asset management. He began his career at Morgan Stanley, where he rose to become the firm's top producer nationwide, managing more than one billion dollars in client assets. He later founded Chapwood Investments, where he serves as Managing Partner, focusing on disciplined investment strategies, market analysis, and risk management. Ed is widely respected for his ability to synthesize political, economic, and market dynamics into actionable investment insights. In his personal life, he enjoys watching football and spending time with his family.",
                    "Ed earned a BA, Communications from the University of Texas at Austin."
                ],
                links: [
                    { url: "https://edbutowsky.com/", label: "Website" },
                    { url: "https://www.linkedin.com/in/edbutowsky/", label: "LinkedIn" }
                ]
            },
            dani: {
                name: "Dani Butowsky",
                paragraphs: [
                    "Dani Butowsky has devoted her life to family, community, and service. Raised across multiple locations due to her father's military career, she developed adaptability, cultural awareness, and a strong sense of connection from an early age. After settling in Overland Park, Kansas, she attended the University of Texas at Austin, where she was a member of the Pom Squad. Known for her warmth, grace, and commitment to others, Dani has dedicated significant time to philanthropic and nonprofit efforts. Above all, she takes pride in her role as a devoted mother and homemaker, instilling values of ambition, kindness, and service in her children.",
                    "Dani earned a BA, Communications from the University of Texas at Austin."
                ],
                links: []
            },
            lauren: {
                name: "Lauren Sheppard",
                paragraphs: [
                    "Lauren Sheppard is a strategic communications professional with experience spanning media strategy, branding, and corporate messaging. A Dallas native, she has worked with respected companies across Dallas, building a reputation for creativity, clarity, and leadership in fast-paced environments. She balances a demanding professional career with family life, bringing intention and excellence to both. Lauren is known for her thoughtful approach to communication and her ability to translate complex ideas into compelling narratives.",
                    "Lauren earned a BJ, Strategic Communications from the University of Missouri."
                ],
                links: [
                    { url: "https://www.linkedin.com/in/lauren-butowsky/", label: "LinkedIn" }
                ]
            },
            keaton: {
                name: "Keaton Butowsky",
                paragraphs: [
                    "Keaton Butowsky is a real estate and investment professional focused on financial modeling, investment analysis, and strategic decision-making across modern capital markets. He is currently pursuing an MBA with a concentration in Investments and Real Estate at Southern Methodist University. His interests include history, artificial intelligence, and cooking, reflecting both analytical curiosity and creativity. Based in Dallas, Keaton is driven by continuous learning and long-term professional and personal growth.",
                    "Keaton earned a BA, Economics from Vanderbilt University and is an MBA candidate in Investments and Real Estate at Southern Methodist University."
                ],
                links: [
                    { url: "https://www.linkedin.com/in/keaton-butowsky/", label: "LinkedIn" }
                ]
            },
            ben: {
                name: "Ben Sheppard",
                paragraphs: [
                    "Ben Sheppard is a finance and management professional with a strong quantitative background grounded in analytics, operations, and financial reporting. His academic and professional experiences reflect a disciplined, data-driven approach to decision-making and problem-solving. Outside of work, Ben enjoys barbecuing, cheering on the Dallas Cowboys, and spending time with his pitbull, Marcy. He values family and brings consistency, focus, and care to both his professional and personal life.",
                    "Ben earned a BS, Logistics, Materials, and Supply Chain Management from the University of Maryland and an MS, Accounting from Texas A&M University–Corpus Christi."
                ],
                links: [
                    { url: "https://www.linkedin.com/in/benjamin-sheppard-0aa34487/", label: "LinkedIn" }
                ]
            },
            megan: {
                name: "Megan Williams",
                paragraphs: [
                    "Megan Williams is a social media strategist and entrepreneur who transformed a lifelong passion for the arts into a growing business. She grew up as a ballet dancer, training at prestigious ballet schools, where she developed discipline, visual storytelling skills, and a refined aesthetic sensibility. She currently works as a Social Media Manager at Three Headed Monster while building her own social media management firm, 519 Strategy. Her interests include vlogging, Pilates, Starbucks, and intentionally growing her business with creativity and purpose.",
                    "Megan earned a BS, Public Relations, Advertising, and Applied Communication from Texas Christian University."
                ],
                links: [
                    { url: "https://www.linkedin.com/in/meganwilliams519/", label: "LinkedIn" },
                    { url: "https://www.519strategy.com/", label: "Website" }
                ]
            }
        };

        // Track which lines have been animated
        const animatedLines = new Set();
        let linesInitialized = false;

        // Get center coordinates of an element relative to canvas
        function getCenter(id) {
            const el = document.getElementById(id);
            const canvas = document.getElementById('treeCanvas');
            if (!el || !canvas) return { x: 0, y: 0 };
            
            const rect = el.getBoundingClientRect();
            const canvasRect = canvas.getBoundingClientRect();
            
            return {
                x: rect.left + rect.width / 2 - canvasRect.left,
                y: rect.top + rect.height / 2 - canvasRect.top
            };
        }

        // Create a single SVG line element
        function createLine(svg, id) {
            const existing = document.getElementById(id);
            if (existing) return existing;
            
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            line.setAttribute('id', id);
            line.setAttribute('class', 'connection-line');
            svg.appendChild(line);
            return line;
        }

        // Update line position and set up animation
        function updateLine(line, x1, y1, x2, y2) {
            const d = `M ${x1} ${y1} L ${x2} ${y2}`;
            line.setAttribute('d', d);
            
            // Calculate actual line length for smooth animation
            const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            line.style.strokeDasharray = length;
            line.style.setProperty('--line-length', length);
            line.style.strokeDashoffset = length;
        }

        // Initialize all lines (create elements, but don't show them)
        function initializeLines() {
            const svg = document.getElementById('treeSvg');
            if (!svg) return;

            // Create all line elements
            createLine(svg, 'edDaniLine');
            createLine(svg, 'parentChildLine');
            createLine(svg, 'childrenLine');
            createLine(svg, 'laurenLine');
            createLine(svg, 'keatonLine');
            createLine(svg, 'benLaurenLine');
            createLine(svg, 'meganKeatonLine');

            linesInitialized = true;
            updateLinePositions();
        }

        // Update positions of all lines based on current element positions
        function updateLinePositions() {
            if (!linesInitialized) return;

            const ed = getCenter('ed');
            const dani = getCenter('dani');
            const lauren = getCenter('lauren');
            const keaton = getCenter('keaton');
            const ben = getCenter('ben');
            const megan = getCenter('megan');

            // Ed to Dani marriage line
            const edDaniLine = document.getElementById('edDaniLine');
            if (edDaniLine) updateLine(edDaniLine, ed.x, ed.y, dani.x, dani.y);

            // Calculate midpoints for family tree structure
            const parentMidX = (ed.x + dani.x) / 2;
            const childMidY = Math.min(lauren.y, keaton.y) - 50;

            // Parent to children vertical line
            const parentChildLine = document.getElementById('parentChildLine');
            if (parentChildLine) updateLine(parentChildLine, parentMidX, ed.y, parentMidX, childMidY);

            // Children horizontal connector
            const childrenLine = document.getElementById('childrenLine');
            if (childrenLine) updateLine(childrenLine, lauren.x, childMidY, keaton.x, childMidY);

            // Lauren vertical drop
            const laurenLine = document.getElementById('laurenLine');
            if (laurenLine) updateLine(laurenLine, lauren.x, childMidY, lauren.x, lauren.y);

            // Keaton vertical drop
            const keatonLine = document.getElementById('keatonLine');
            if (keatonLine) updateLine(keatonLine, keaton.x, childMidY, keaton.x, keaton.y);

            // Ben to Lauren line
            const benLaurenLine = document.getElementById('benLaurenLine');
            if (benLaurenLine) updateLine(benLaurenLine, ben.x, ben.y, lauren.x, lauren.y);

            // Megan to Keaton line
            const meganKeatonLine = document.getElementById('meganKeatonLine');
            if (meganKeatonLine) updateLine(meganKeatonLine, megan.x, megan.y, keaton.x, keaton.y);
        }

        // Show a line with animation
        function showLine(lineId) {
            const line = document.getElementById(lineId);
            if (!line) return;

            line.classList.add('visible');
            
            // Only animate if we haven't animated this line before
            if (!animatedLines.has(lineId)) {
                animatedLines.add(lineId);
                line.classList.add('animate');
            } else {
                // If already animated, just show it instantly
                line.style.strokeDashoffset = '0';
            }
        }

        // Hide a line
        function hideLine(lineId) {
            const line = document.getElementById(lineId);
            if (!line) return;

            line.classList.remove('visible');
            line.classList.remove('animate');
            
            // Reset the animation state
            animatedLines.delete(lineId);
            const length = parseFloat(line.style.strokeDasharray) || 1000;
            line.style.strokeDashoffset = length;
        }

        // Initialize on load
        window.addEventListener('load', () => {
            setTimeout(initializeLines, 100);
        });

        // Recalculate on resize (debounced)
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                updateLinePositions();
            }, 100);
        });

        // Scroll Animation - FIXED: Adjusted trigger points for better mobile experience
        let ticking = false;
        
        window.addEventListener('scroll', () => {
            if (!ticking) {
                window.requestAnimationFrame(() => {
                    handleScroll();
                    ticking = false;
                });
                ticking = true;
            }
        });

        function handleScroll() {
            const scrollPos = window.scrollY;
            const windowHeight = window.innerHeight;
            const treeStart = windowHeight * 0.8; // Start a bit earlier
            
            // Fade out family photo
            const photo = document.getElementById('familyPhoto');
            if (photo) {
                if (scrollPos > windowHeight * 0.3) {
                    photo.style.opacity = Math.max(0, 1 - (scrollPos - windowHeight * 0.3) / 300);
                } else {
                    photo.style.opacity = 1;
                }
            }

            // Update line positions on scroll (handles sticky positioning)
            updateLinePositions();
            
            // Progressive reveal stages - FIXED: Reduced distances for mobile compatibility
            const stages = [
                { 
                    scroll: treeStart, 
                    elements: ['ed'], 
                    lines: [],
                    labels: []
                },
                { 
                    scroll: treeStart + 200, 
                    elements: ['dani'], 
                    lines: ['edDaniLine'], 
                    labels: ['marriageLabel'] 
                },
                { 
                    scroll: treeStart + 400, 
                    elements: ['lauren'], 
                    lines: ['parentChildLine', 'childrenLine', 'laurenLine'], 
                    labels: [] 
                },
                { 
                    scroll: treeStart + 550, 
                    elements: ['keaton'], 
                    lines: ['keatonLine'], 
                    labels: [] 
                },
                { 
                    scroll: treeStart + 750, 
                    elements: ['ben'], 
                    lines: ['benLaurenLine'], 
                    labels: ['benLaurenLabel'] 
                },
                { 
                    scroll: treeStart + 950, 
                    elements: ['megan'], 
                    lines: ['meganKeatonLine'], 
                    labels: ['meganKeatonLabel'] 
                }
            ];

            stages.forEach(stage => {
                const isActive = scrollPos >= stage.scroll;
                
                // Handle elements
                stage.elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        if (isActive) {
                            element.classList.add('visible');
                        } else {
                            element.classList.remove('visible');
                        }
                    }
                });
                
                // Handle lines
                stage.lines.forEach(id => {
                    if (isActive) {
                        showLine(id);
                    } else {
                        hideLine(id);
                    }
                });
                
                // Handle labels
                stage.labels.forEach(id => {
                    const label = document.getElementById(id);
                    if (label) {
                        if (isActive) {
                            label.classList.add('visible');
                        } else {
                            label.classList.remove('visible');
                        }
                    }
                });
            });
        }

        // Bio Modal
        document.querySelectorAll('.member').forEach(member => {
            member.addEventListener('click', function() {
                const memberId = this.dataset.member;
                const bio = bios[memberId];
                
                if (!bio) return;
                
                document.getElementById('bioName').textContent = bio.name;
                
                // Create paragraphs
                const bioTextContainer = document.getElementById('bioText');
                bioTextContainer.innerHTML = '';
                bio.paragraphs.forEach(paragraph => {
                    const p = document.createElement('p');
                    p.className = 'bio-text';
                    p.textContent = paragraph;
                    bioTextContainer.appendChild(p);
                });
                
                // Populate links
                const linksContainer = document.getElementById('bioLinks');
                linksContainer.innerHTML = '';
                if (bio.links && bio.links.length > 0) {
                    bio.links.forEach(link => {
                        const linkElement = document.createElement('a');
                        linkElement.href = link.url;
                        linkElement.target = '_blank';
                        linkElement.rel = 'noopener noreferrer';
                        linkElement.className = 'bio-link';
                        linkElement.textContent = link.label;
                        linksContainer.appendChild(linkElement);
                    });
                }
                
                document.getElementById('bioModal').classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent background scroll
            });
        });

        function closeBio() {
            document.getElementById('bioModal').classList.remove('active');
            document.body.style.overflow = ''; // Restore scroll
        }

        document.getElementById('bioModal').addEventListener('click', function(e) {
            if (e.target === this) closeBio();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeBio();
        });

        // Touch support for mobile
        let touchStartY = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        }, { passive: true });
    </script>
</body>
</html>
